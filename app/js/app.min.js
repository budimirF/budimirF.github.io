(function() {
    'use strict';
    var app = angular.module('rssReader', ['ui.router']);
    app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider', function($stateProvider, $urlRouterProvider, $httpProvider) {
        $urlRouterProvider.otherwise('home');
        $stateProvider.state('home', {
                url: '/home',
                templateUrl: "templates/home.html",
                controller: 'homeController'
            })
            .state('login', {
                url: '/login',
                templateUrl: 'templates/login.html',
                // controller: 'loginController'
            })
            .state('dashboard', {
                url: '/dashboard',
                views: {
                    '': {
                        templateUrl: 'templates/dashboard.html',
                        controller: 'dashboardController'
                    },
                    'head@dashboard' : {
                        templateUrl: 'templates/dashboardHead.html',
                        controller: 'dashboardController'
                    },
                    'sidebar' : {
                        templateUrl: 'templates/sidebar.html',
                        controller: 'sidebarController'
                    }
                }
            })
            .state('dashboard.list-lg', {
                url: '/list-lg',
                templateUrl: 'templates/dashboardListLg.html',
                controller: 'dashboardController'
            })
            .state('dashboard.add', {
                    url: '/add',
                    templateUrl: 'templates/add.html',
                    controller: 'addController'
            });
    }]);
})();

(function() {
    'use strict';
    angular.module('rssReader').controller('addController', ['$scope', '$state', 'addFeedService',  function($scope, $state, addFeedService) {
        $scope.feed = {};
        $scope.getFeed = function () {
            addFeedService.getSrcFeed($scope.feedUrl).then(function(res) {
                $scope.feed = addFeedService.getParsedFeed(res, $scope.feedCategory);
                addFeedService.saveData($scope.feed);
                $state.go('dashboard.list-lg');
            });
        }
        
    }]);

})();
(function() {
    'use strict';
    angular.module('rssReader').controller('dashboardController', ['$scope', '$state', 'addFeedService', 'dashboardService', function($scope, $state, addFeedService, dashboardService) {
        $scope.articles = dashboardService.getArticles();
        
        // console.log($scope.articles);
        if (!$scope.articles) {
            $state.go('dashboard.add');
        }

        $scope.isRead = function () {
            let re = new RegExp("dashboard.add");
            return (!re.test($state.current.name));
        }

    }]);

})();
(function () {
    'use strict';
    angular.module('rssReader').controller('homeController', ['$scope', '$state', function($scope, $state){
        $scope.test = "hello world!!!";
    }]);

})();


(function() {
    'use strict';
    angular.module('rssReader').controller('navController', ['$scope', '$state', function($scope, $state) {
      $scope.isDasboard = function () {
        return /dashboard/.test($state.current.name);
      }
    }]);

})();
(function() {
    'use strict';
    angular.module('rssReader').controller('sidebarController', ['$scope', '$rootScope', '$state', 'dashboardService', function($scope, $state, $rootScope, dashboardService) {
        var getListSidebar = dashboardService.getCategorySidebar;
        
        $scope.$watch(function () {
            return JSON.stringify(getListSidebar());
        }, function () {
            $scope.listFeedSidebar = getListSidebar();
        });

        $scope.rotateChevron = function($event) {
            var chevronRigth = angular.element($event.target).children().hasClass('chevronRotate'),
                chevronDown = angular.element($event.target).children().hasClass('chevronRotated');
            
            if (chevronRigth && !chevronDown) {
                angular.element($event.target).children().addClass('chevronRotated');
            } else {
                angular.element($event.target).children().removeClass('chevronRotated');
            }
        }
    }]);

})();

angular.module('rssReader').factory('addFeedService', ['$http', function($http) {
    'use strict';
    var listFeeds = [];

    function saveData (feed) {
        listFeeds.push(feed);
    }

    function getText(html) {
        return angular.element(`<div>${html}</div>`).text().replace(/\n+/g,' ');
    }

    function getImgUrl (html) {
        var imgElem = angular.element(`<div>${html}</div>`).find('img')[0];
        return imgElem ? imgElem.src : '';
    }

    function getDate (dateRaw) {
        return moment(new Date(dateRaw)).format('DD-MM-YYYY HH:mm');
    }

    function getSrcFeed(url) {
        return $http.jsonp('https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=' + encodeURIComponent(url)).
        then(function(response) {
            return response.data;
        });
    }

    function getParsedArticles (articles, category) {
        var changedArticles = [];
        articles.forEach( function(el) {
            changedArticles.push({
                title : el.title,
                category: category,
                content : getText(el.content),
                img : getImgUrl(el.content),
                link : el.link,
                date : getDate(el.publishedDate)
            })
        });
        return changedArticles;
    }

    function getParsedFeed(feed, category) {
        feed = feed.responseData.feed;
        return {
            feedTitle : feed.title,
            feedCategory: category,
            feedDescription : feed.description,
            feedArticles : getParsedArticles(feed.entries, category)
        }
    }

    function getSavedFeeds () {
        return  listFeeds;
    }

    return {
        getSrcFeed : getSrcFeed,
        getParsedFeed: getParsedFeed,
        saveData : saveData,
        getSavedFeeds : getSavedFeeds
    }
}]);

angular.module('rssReader').factory('dashboardService', ['addFeedService', '$filter', function(addFeedService, $filter) {
    'use strict';
    var listFeeds = addFeedService.getSavedFeeds();

    function getCategorySidebar() {
        var listFeedSidebar = [];
        var listWork = [];
        var foundElem;

        if (!listFeeds.length) {
            return false;
        } else {
            listFeeds.forEach(function(element, index) {
                listWork.push({
                    feedCategory: element.feedCategory,
                    feedId: index,
                    feedTitle: [element.feedTitle]
                })
            });
        }

        listWork.forEach(function(element, index) {

            foundElem = listFeedSidebar.find(function(elem) {
                return elem.feedCategory == element.feedCategory;
            });

            if (foundElem) {
                foundElem.feedTitle = foundElem.feedTitle.concat(element.feedTitle);
            } else {
                listFeedSidebar.push(element);
            }

        });

        return listFeedSidebar;
    }

    function getArticles(category) {
        var articles;
        if (listFeeds.length) {
            articles = [];
            listFeeds.forEach(function(elem) {
                articles = articles.concat(elem.feedArticles);
            });
        }
        return articles;
    }

    return {
        getArticles: getArticles,
        getCategorySidebar: getCategorySidebar
    }
}]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhcHAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInLCBbJ3VpLnJvdXRlciddKTtcclxuICAgIGFwcC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCAnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCdob21lJyk7XHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ0ZW1wbGF0ZXMvaG9tZS5odG1sXCIsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnaG9tZUNvbnRyb2xsZXInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Rhc2hib2FyZCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9kYXNoYm9hcmQnLFxyXG4gICAgICAgICAgICAgICAgdmlld3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAnJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kYXNoYm9hcmQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDb250cm9sbGVyJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ2hlYWRAZGFzaGJvYXJkJyA6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGFzaGJvYXJkSGVhZC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZENvbnRyb2xsZXInXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZWJhcicgOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL3NpZGViYXIuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzaWRlYmFyQ29udHJvbGxlcidcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZGFzaGJvYXJkLmxpc3QtbGcnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbGlzdC1sZycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kYXNoYm9hcmRMaXN0TGcuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdkYXNoYm9hcmQuYWRkJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hZGQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2FkZC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWRkQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XHJcbn0pKCk7XHJcblxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ3Jzc1JlYWRlcicpLmNvbnRyb2xsZXIoJ2FkZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnYWRkRmVlZFNlcnZpY2UnLCAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIGFkZEZlZWRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmZlZWQgPSB7fTtcclxuICAgICAgICAkc2NvcGUuZ2V0RmVlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWRkRmVlZFNlcnZpY2UuZ2V0U3JjRmVlZCgkc2NvcGUuZmVlZFVybCkudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5mZWVkID0gYWRkRmVlZFNlcnZpY2UuZ2V0UGFyc2VkRmVlZChyZXMsICRzY29wZS5mZWVkQ2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICAgICAgYWRkRmVlZFNlcnZpY2Uuc2F2ZURhdGEoJHNjb3BlLmZlZWQpO1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdkYXNoYm9hcmQubGlzdC1sZycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ3Jzc1JlYWRlcicpLmNvbnRyb2xsZXIoJ2Rhc2hib2FyZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnYWRkRmVlZFNlcnZpY2UnLCAnZGFzaGJvYXJkU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBhZGRGZWVkU2VydmljZSwgZGFzaGJvYXJkU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5hcnRpY2xlcyA9IGRhc2hib2FyZFNlcnZpY2UuZ2V0QXJ0aWNsZXMoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuYXJ0aWNsZXMpO1xyXG4gICAgICAgIGlmICghJHNjb3BlLmFydGljbGVzKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZGFzaGJvYXJkLmFkZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmlzUmVhZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cChcImRhc2hib2FyZC5hZGRcIik7XHJcbiAgICAgICAgICAgIHJldHVybiAoIXJlLnRlc3QoJHN0YXRlLmN1cnJlbnQubmFtZSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInKS5jb250cm9sbGVyKCdob21lQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlKXtcclxuICAgICAgICAkc2NvcGUudGVzdCA9IFwiaGVsbG8gd29ybGQhISFcIjtcclxuICAgIH1dKTtcclxuXHJcbn0pKCk7XHJcblxyXG5cbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInKS5jb250cm9sbGVyKCduYXZDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUpIHtcclxuICAgICAgJHNjb3BlLmlzRGFzYm9hcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIC9kYXNoYm9hcmQvLnRlc3QoJHN0YXRlLmN1cnJlbnQubmFtZSk7XHJcbiAgICAgIH1cclxuICAgIH1dKTtcclxuXHJcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgncnNzUmVhZGVyJykuY29udHJvbGxlcignc2lkZWJhckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRzdGF0ZScsICdkYXNoYm9hcmRTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRyb290U2NvcGUsIGRhc2hib2FyZFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgZ2V0TGlzdFNpZGViYXIgPSBkYXNoYm9hcmRTZXJ2aWNlLmdldENhdGVnb3J5U2lkZWJhcjtcclxuICAgICAgICBcclxuICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGdldExpc3RTaWRlYmFyKCkpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmxpc3RGZWVkU2lkZWJhciA9IGdldExpc3RTaWRlYmFyKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5yb3RhdGVDaGV2cm9uID0gZnVuY3Rpb24oJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBjaGV2cm9uUmlndGggPSBhbmd1bGFyLmVsZW1lbnQoJGV2ZW50LnRhcmdldCkuY2hpbGRyZW4oKS5oYXNDbGFzcygnY2hldnJvblJvdGF0ZScpLFxyXG4gICAgICAgICAgICAgICAgY2hldnJvbkRvd24gPSBhbmd1bGFyLmVsZW1lbnQoJGV2ZW50LnRhcmdldCkuY2hpbGRyZW4oKS5oYXNDbGFzcygnY2hldnJvblJvdGF0ZWQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChjaGV2cm9uUmlndGggJiYgIWNoZXZyb25Eb3duKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGV2ZW50LnRhcmdldCkuY2hpbGRyZW4oKS5hZGRDbGFzcygnY2hldnJvblJvdGF0ZWQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZXZlbnQudGFyZ2V0KS5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCdjaGV2cm9uUm90YXRlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xyXG5cclxufSkoKTtcclxuXG5hbmd1bGFyLm1vZHVsZSgncnNzUmVhZGVyJykuZmFjdG9yeSgnYWRkRmVlZFNlcnZpY2UnLCBbJyRodHRwJywgZnVuY3Rpb24oJGh0dHApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIHZhciBsaXN0RmVlZHMgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBzYXZlRGF0YSAoZmVlZCkge1xyXG4gICAgICAgIGxpc3RGZWVkcy5wdXNoKGZlZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFRleHQoaHRtbCkge1xyXG4gICAgICAgIHJldHVybiBhbmd1bGFyLmVsZW1lbnQoYDxkaXY+JHtodG1sfTwvZGl2PmApLnRleHQoKS5yZXBsYWNlKC9cXG4rL2csJyAnKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRJbWdVcmwgKGh0bWwpIHtcclxuICAgICAgICB2YXIgaW1nRWxlbSA9IGFuZ3VsYXIuZWxlbWVudChgPGRpdj4ke2h0bWx9PC9kaXY+YCkuZmluZCgnaW1nJylbMF07XHJcbiAgICAgICAgcmV0dXJuIGltZ0VsZW0gPyBpbWdFbGVtLnNyYyA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldERhdGUgKGRhdGVSYXcpIHtcclxuICAgICAgICByZXR1cm4gbW9tZW50KG5ldyBEYXRlKGRhdGVSYXcpKS5mb3JtYXQoJ0RELU1NLVlZWVkgSEg6bW0nKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTcmNGZWVkKHVybCkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5qc29ucCgnaHR0cHM6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvc2VydmljZXMvZmVlZC9sb2FkP3Y9MS4wJm51bT01MCZjYWxsYmFjaz1KU09OX0NBTExCQUNLJnE9JyArIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpKS5cclxuICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFBhcnNlZEFydGljbGVzIChhcnRpY2xlcywgY2F0ZWdvcnkpIHtcclxuICAgICAgICB2YXIgY2hhbmdlZEFydGljbGVzID0gW107XHJcbiAgICAgICAgYXJ0aWNsZXMuZm9yRWFjaCggZnVuY3Rpb24oZWwpIHtcclxuICAgICAgICAgICAgY2hhbmdlZEFydGljbGVzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgOiBlbC50aXRsZSxcclxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQgOiBnZXRUZXh0KGVsLmNvbnRlbnQpLFxyXG4gICAgICAgICAgICAgICAgaW1nIDogZ2V0SW1nVXJsKGVsLmNvbnRlbnQpLFxyXG4gICAgICAgICAgICAgICAgbGluayA6IGVsLmxpbmssXHJcbiAgICAgICAgICAgICAgICBkYXRlIDogZ2V0RGF0ZShlbC5wdWJsaXNoZWREYXRlKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjaGFuZ2VkQXJ0aWNsZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0UGFyc2VkRmVlZChmZWVkLCBjYXRlZ29yeSkge1xyXG4gICAgICAgIGZlZWQgPSBmZWVkLnJlc3BvbnNlRGF0YS5mZWVkO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGZlZWRUaXRsZSA6IGZlZWQudGl0bGUsXHJcbiAgICAgICAgICAgIGZlZWRDYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIGZlZWREZXNjcmlwdGlvbiA6IGZlZWQuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGZlZWRBcnRpY2xlcyA6IGdldFBhcnNlZEFydGljbGVzKGZlZWQuZW50cmllcywgY2F0ZWdvcnkpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFNhdmVkRmVlZHMgKCkge1xyXG4gICAgICAgIHJldHVybiAgbGlzdEZlZWRzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0U3JjRmVlZCA6IGdldFNyY0ZlZWQsXHJcbiAgICAgICAgZ2V0UGFyc2VkRmVlZDogZ2V0UGFyc2VkRmVlZCxcclxuICAgICAgICBzYXZlRGF0YSA6IHNhdmVEYXRhLFxyXG4gICAgICAgIGdldFNhdmVkRmVlZHMgOiBnZXRTYXZlZEZlZWRzXHJcbiAgICB9XHJcbn1dKTtcclxuXG5hbmd1bGFyLm1vZHVsZSgncnNzUmVhZGVyJykuZmFjdG9yeSgnZGFzaGJvYXJkU2VydmljZScsIFsnYWRkRmVlZFNlcnZpY2UnLCAnJGZpbHRlcicsIGZ1bmN0aW9uKGFkZEZlZWRTZXJ2aWNlLCAkZmlsdGVyKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICB2YXIgbGlzdEZlZWRzID0gYWRkRmVlZFNlcnZpY2UuZ2V0U2F2ZWRGZWVkcygpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldENhdGVnb3J5U2lkZWJhcigpIHtcclxuICAgICAgICB2YXIgbGlzdEZlZWRTaWRlYmFyID0gW107XHJcbiAgICAgICAgdmFyIGxpc3RXb3JrID0gW107XHJcbiAgICAgICAgdmFyIGZvdW5kRWxlbTtcclxuXHJcbiAgICAgICAgaWYgKCFsaXN0RmVlZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsaXN0RmVlZHMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50LCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgbGlzdFdvcmsucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgZmVlZENhdGVnb3J5OiBlbGVtZW50LmZlZWRDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgICAgICBmZWVkSWQ6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZWRUaXRsZTogW2VsZW1lbnQuZmVlZFRpdGxlXVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsaXN0V29yay5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4KSB7XHJcblxyXG4gICAgICAgICAgICBmb3VuZEVsZW0gPSBsaXN0RmVlZFNpZGViYXIuZmluZChmdW5jdGlvbihlbGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5mZWVkQ2F0ZWdvcnkgPT0gZWxlbWVudC5mZWVkQ2F0ZWdvcnk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZvdW5kRWxlbSkge1xyXG4gICAgICAgICAgICAgICAgZm91bmRFbGVtLmZlZWRUaXRsZSA9IGZvdW5kRWxlbS5mZWVkVGl0bGUuY29uY2F0KGVsZW1lbnQuZmVlZFRpdGxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxpc3RGZWVkU2lkZWJhci5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbGlzdEZlZWRTaWRlYmFyO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEFydGljbGVzKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgdmFyIGFydGljbGVzO1xyXG4gICAgICAgIGlmIChsaXN0RmVlZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGFydGljbGVzID0gW107XHJcbiAgICAgICAgICAgIGxpc3RGZWVkcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pIHtcclxuICAgICAgICAgICAgICAgIGFydGljbGVzID0gYXJ0aWNsZXMuY29uY2F0KGVsZW0uZmVlZEFydGljbGVzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhcnRpY2xlcztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldEFydGljbGVzOiBnZXRBcnRpY2xlcyxcclxuICAgICAgICBnZXRDYXRlZ29yeVNpZGViYXI6IGdldENhdGVnb3J5U2lkZWJhclxyXG4gICAgfVxyXG59XSk7XHJcbiJdLCJmaWxlIjoiYXBwLm1pbi5qcyJ9
