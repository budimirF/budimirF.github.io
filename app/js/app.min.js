(function() {
    'use strict';
    var app = angular.module('rssReader', ['ui.router']);
    app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider', function($stateProvider, $urlRouterProvider, $httpProvider) {
        $urlRouterProvider.otherwise('home');
        $stateProvider.state('home', {
                url: '/home',
                templateUrl: "templates/home.html",
                controller: 'homeController'
            })
            .state('login', {
                url: '/login',
                templateUrl: 'templates/login.html',
                // controller: 'loginController'
            })
            .state('dashboard', {
                url: '/dashboard',
                views: {
                    '': {
                        templateUrl: 'templates/dashboard.html',
                        controller: 'dashboardController'
                    },
                    'head@dashboard' : {
                        templateUrl: 'templates/dashboardHead.html',
                        controller: 'dashboardController'
                    },
                    'sidebar' : {
                        templateUrl: 'templates/sidebar.html',
                        controller: 'sidebarController'
                    }
                }
            })
            .state('dashboard.list-lg', {
                url: '/list-lg',
                templateUrl: 'templates/dashboardListLg.html',
                controller: 'dashboardController'
            })
            .state('dashboard.add', {
                    url: '/add',
                    templateUrl: 'templates/add.html',
                    controller: 'addController'
            });
    }]);
})();

(function() {
    'use strict';
    angular.module('rssReader').controller('addController', ['$scope', '$state', 'addFeedService',  function($scope, $state, addFeedService) {
        $scope.feed = {};
        $scope.getFeed = function () {
            addFeedService.getSrcFeed($scope.feedUrl).then(function(res) {
                console.log(res);
                $scope.feed = addFeedService.getParsedFeed(res, $scope.feedCategory);
                addFeedService.saveData($scope.feed);
                console.log($scope.feed)
                $state.go('dashboard.list-lg');
            });
        }
        
    }]);

})();
(function() {
    'use strict';
    angular.module('rssReader').controller('dashboardController', ['$scope', '$state', 'addFeedService', 'dashboardService', function($scope, $state, addFeedService, dashboardService) {
        $scope.articles = dashboardService.getArticles();
        // console.log($scope.articles);
        if (!$scope.articles) {
            $state.go('dashboard.add');
        }

        $scope.isRead = function () {
            let re = new RegExp("dashboard.add");
            return (!re.test($state.current.name));
        }

    }]);

})();
(function () {
    'use strict';
    angular.module('rssReader').controller('homeController', ['$scope', '$state', function($scope, $state){
        $scope.test = "hello world!!!";
    }]);

})();


(function() {
    'use strict';
    angular.module('rssReader').controller('navController', ['$scope', '$state', function($scope, $state) {
      $scope.isDasboard = function () {
        return /dashboard/.test($state.current.name);
      }
    }]);

})();
(function() {
    'use strict';
    angular.module('rssReader').controller('sidebarController', ['$scope', '$state', 'dashboardService', function($scope, $state, dashboardService) {
        $scope.getListCategory = function () {
           $scope.listSidebar = dashboardService.getCategorySidebar();
           // console.log($scope.listSidebar);
        } 

        $scope.rotateChevron = function($event) {
            var chevronRigth = angular.element($event.target).children().hasClass('chevronRotate'),
                chevronDown = angular.element($event.target).children().hasClass('chevronRotated');
            
            if (chevronRigth && !chevronDown) {
                angular.element($event.target).children().addClass('chevronRotated');
            } else {
                angular.element($event.target).children().removeClass('chevronRotated');
            }
        }
    }]);

})();

angular.module('rssReader').factory('addFeedService', ['$http', function($http) {
    'use strict';
    var listFeeds = [];

    function saveData (feed) {
        listFeeds.push(feed);
    }

    function getText(html) {
        return angular.element(`<div>${html}</div>`).text().replace(/\n+/g,' ');
    }

    function getImgUrl (html) {
        var imgElem = angular.element(`<div>${html}</div>`).find('img')[0];
        return imgElem ? imgElem.src : '';
    }

    function getDate (dateRaw) {
        console.log(dateRaw);
        var date = new Date(dateRaw);
        console.log(date);
        return date;
    }

    function getSrcFeed(url) {
        return $http.jsonp('https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=' + encodeURIComponent(url)).
        then(function(response) {
            return response.data;
        });
    }

    function getParsedArticles (articles, category) {
        var changedArticles = [];
        articles.forEach( function(el) {
            changedArticles.push({
                title : el.title,
                category: category,
                content : getText(el.content),
                img : getImgUrl(el.content),
                link : el.link,
                date : getDate(el.publishedDate)
            })
        });
        return changedArticles;
    }

    function getParsedFeed(feed, category) {
        feed = feed.responseData.feed;
        return {
            feedTitle : feed.title,
            feedCategory: category,
            feedDescription : feed.description,
            feedArticles : getParsedArticles(feed.entries, category)
        }
    }

    function getSavedFeeds () {
        return  listFeeds;
    }

    return {
        getSrcFeed : getSrcFeed,
        getParsedFeed: getParsedFeed,
        saveData : saveData,
        getSavedFeeds : getSavedFeeds
    }
}]);

angular.module('rssReader').factory('dashboardService', ['addFeedService', '$filter', function(addFeedService, $filter) {
    'use strict';
    var listFeeds = addFeedService.getSavedFeeds();

    function getCategorySidebar() {
        var listFeedSidebar = [];

        if (listFeeds.length) {
            listFeeds.forEach(function(elem, index) {
                listFeedSidebar.push({
                    category: elem.feedCategory,
                    id: index,
                    titleFeeds: [elem.feedTitle]
                })
            });
        }
        return listFeedSidebar;
    }


    function getArticles(category) {
        var articles;

        if (listFeeds.length) {
            articles = [];
            listFeeds.forEach( function(elem) {
                // console.log(elem.feedArticles);
                elem.feedArticles.forEach( function(elem) {
                    articles.push(elem)
                });
            });
        }
        return articles;
        // return listFeeds.length ? listFeeds[0].feedArticles : '';
    }

    return {
        getArticles: getArticles,
        getCategorySidebar: getCategorySidebar
    }
}]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhcHAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInLCBbJ3VpLnJvdXRlciddKTtcclxuICAgIGFwcC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCAnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCdob21lJyk7XHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ0ZW1wbGF0ZXMvaG9tZS5odG1sXCIsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnaG9tZUNvbnRyb2xsZXInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Rhc2hib2FyZCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9kYXNoYm9hcmQnLFxyXG4gICAgICAgICAgICAgICAgdmlld3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAnJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kYXNoYm9hcmQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDb250cm9sbGVyJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ2hlYWRAZGFzaGJvYXJkJyA6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGFzaGJvYXJkSGVhZC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZENvbnRyb2xsZXInXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZWJhcicgOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL3NpZGViYXIuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzaWRlYmFyQ29udHJvbGxlcidcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZGFzaGJvYXJkLmxpc3QtbGcnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbGlzdC1sZycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kYXNoYm9hcmRMaXN0TGcuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdkYXNoYm9hcmQuYWRkJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hZGQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2FkZC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWRkQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XHJcbn0pKCk7XHJcblxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ3Jzc1JlYWRlcicpLmNvbnRyb2xsZXIoJ2FkZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnYWRkRmVlZFNlcnZpY2UnLCAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIGFkZEZlZWRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmZlZWQgPSB7fTtcclxuICAgICAgICAkc2NvcGUuZ2V0RmVlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWRkRmVlZFNlcnZpY2UuZ2V0U3JjRmVlZCgkc2NvcGUuZmVlZFVybCkudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmVlZCA9IGFkZEZlZWRTZXJ2aWNlLmdldFBhcnNlZEZlZWQocmVzLCAkc2NvcGUuZmVlZENhdGVnb3J5KTtcclxuICAgICAgICAgICAgICAgIGFkZEZlZWRTZXJ2aWNlLnNhdmVEYXRhKCRzY29wZS5mZWVkKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5mZWVkKVxyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdkYXNoYm9hcmQubGlzdC1sZycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ3Jzc1JlYWRlcicpLmNvbnRyb2xsZXIoJ2Rhc2hib2FyZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnYWRkRmVlZFNlcnZpY2UnLCAnZGFzaGJvYXJkU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBhZGRGZWVkU2VydmljZSwgZGFzaGJvYXJkU2VydmljZSkge1xyXG4gICAgICAgICRzY29wZS5hcnRpY2xlcyA9IGRhc2hib2FyZFNlcnZpY2UuZ2V0QXJ0aWNsZXMoKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuYXJ0aWNsZXMpO1xyXG4gICAgICAgIGlmICghJHNjb3BlLmFydGljbGVzKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZGFzaGJvYXJkLmFkZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmlzUmVhZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cChcImRhc2hib2FyZC5hZGRcIik7XHJcbiAgICAgICAgICAgIHJldHVybiAoIXJlLnRlc3QoJHN0YXRlLmN1cnJlbnQubmFtZSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInKS5jb250cm9sbGVyKCdob21lQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlKXtcclxuICAgICAgICAkc2NvcGUudGVzdCA9IFwiaGVsbG8gd29ybGQhISFcIjtcclxuICAgIH1dKTtcclxuXHJcbn0pKCk7XHJcblxyXG5cbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInKS5jb250cm9sbGVyKCduYXZDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUpIHtcclxuICAgICAgJHNjb3BlLmlzRGFzYm9hcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIC9kYXNoYm9hcmQvLnRlc3QoJHN0YXRlLmN1cnJlbnQubmFtZSk7XHJcbiAgICAgIH1cclxuICAgIH1dKTtcclxuXHJcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgncnNzUmVhZGVyJykuY29udHJvbGxlcignc2lkZWJhckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnZGFzaGJvYXJkU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBkYXNoYm9hcmRTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmdldExpc3RDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAkc2NvcGUubGlzdFNpZGViYXIgPSBkYXNoYm9hcmRTZXJ2aWNlLmdldENhdGVnb3J5U2lkZWJhcigpO1xyXG4gICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5saXN0U2lkZWJhcik7XHJcbiAgICAgICAgfSBcclxuXHJcbiAgICAgICAgJHNjb3BlLnJvdGF0ZUNoZXZyb24gPSBmdW5jdGlvbigkZXZlbnQpIHtcclxuICAgICAgICAgICAgdmFyIGNoZXZyb25SaWd0aCA9IGFuZ3VsYXIuZWxlbWVudCgkZXZlbnQudGFyZ2V0KS5jaGlsZHJlbigpLmhhc0NsYXNzKCdjaGV2cm9uUm90YXRlJyksXHJcbiAgICAgICAgICAgICAgICBjaGV2cm9uRG93biA9IGFuZ3VsYXIuZWxlbWVudCgkZXZlbnQudGFyZ2V0KS5jaGlsZHJlbigpLmhhc0NsYXNzKCdjaGV2cm9uUm90YXRlZCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGNoZXZyb25SaWd0aCAmJiAhY2hldnJvbkRvd24pIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZXZlbnQudGFyZ2V0KS5jaGlsZHJlbigpLmFkZENsYXNzKCdjaGV2cm9uUm90YXRlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRldmVudC50YXJnZXQpLmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoJ2NoZXZyb25Sb3RhdGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xyXG5cbmFuZ3VsYXIubW9kdWxlKCdyc3NSZWFkZXInKS5mYWN0b3J5KCdhZGRGZWVkU2VydmljZScsIFsnJGh0dHAnLCBmdW5jdGlvbigkaHR0cCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGxpc3RGZWVkcyA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNhdmVEYXRhIChmZWVkKSB7XHJcbiAgICAgICAgbGlzdEZlZWRzLnB1c2goZmVlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0VGV4dChodG1sKSB7XHJcbiAgICAgICAgcmV0dXJuIGFuZ3VsYXIuZWxlbWVudChgPGRpdj4ke2h0bWx9PC9kaXY+YCkudGV4dCgpLnJlcGxhY2UoL1xcbisvZywnICcpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEltZ1VybCAoaHRtbCkge1xyXG4gICAgICAgIHZhciBpbWdFbGVtID0gYW5ndWxhci5lbGVtZW50KGA8ZGl2PiR7aHRtbH08L2Rpdj5gKS5maW5kKCdpbWcnKVswXTtcclxuICAgICAgICByZXR1cm4gaW1nRWxlbSA/IGltZ0VsZW0uc3JjIDogJyc7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0RGF0ZSAoZGF0ZVJhdykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGVSYXcpO1xyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZGF0ZVJhdyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coZGF0ZSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0U3JjRmVlZCh1cmwpIHtcclxuICAgICAgICByZXR1cm4gJGh0dHAuanNvbnAoJ2h0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L3NlcnZpY2VzL2ZlZWQvbG9hZD92PTEuMCZudW09NTAmY2FsbGJhY2s9SlNPTl9DQUxMQkFDSyZxPScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKSkuXHJcbiAgICAgICAgdGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRQYXJzZWRBcnRpY2xlcyAoYXJ0aWNsZXMsIGNhdGVnb3J5KSB7XHJcbiAgICAgICAgdmFyIGNoYW5nZWRBcnRpY2xlcyA9IFtdO1xyXG4gICAgICAgIGFydGljbGVzLmZvckVhY2goIGZ1bmN0aW9uKGVsKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZWRBcnRpY2xlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlIDogZWwudGl0bGUsXHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICBjb250ZW50IDogZ2V0VGV4dChlbC5jb250ZW50KSxcclxuICAgICAgICAgICAgICAgIGltZyA6IGdldEltZ1VybChlbC5jb250ZW50KSxcclxuICAgICAgICAgICAgICAgIGxpbmsgOiBlbC5saW5rLFxyXG4gICAgICAgICAgICAgICAgZGF0ZSA6IGdldERhdGUoZWwucHVibGlzaGVkRGF0ZSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY2hhbmdlZEFydGljbGVzO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFBhcnNlZEZlZWQoZmVlZCwgY2F0ZWdvcnkpIHtcclxuICAgICAgICBmZWVkID0gZmVlZC5yZXNwb25zZURhdGEuZmVlZDtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBmZWVkVGl0bGUgOiBmZWVkLnRpdGxlLFxyXG4gICAgICAgICAgICBmZWVkQ2F0ZWdvcnk6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICBmZWVkRGVzY3JpcHRpb24gOiBmZWVkLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBmZWVkQXJ0aWNsZXMgOiBnZXRQYXJzZWRBcnRpY2xlcyhmZWVkLmVudHJpZXMsIGNhdGVnb3J5KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTYXZlZEZlZWRzICgpIHtcclxuICAgICAgICByZXR1cm4gIGxpc3RGZWVkcztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldFNyY0ZlZWQgOiBnZXRTcmNGZWVkLFxyXG4gICAgICAgIGdldFBhcnNlZEZlZWQ6IGdldFBhcnNlZEZlZWQsXHJcbiAgICAgICAgc2F2ZURhdGEgOiBzYXZlRGF0YSxcclxuICAgICAgICBnZXRTYXZlZEZlZWRzIDogZ2V0U2F2ZWRGZWVkc1xyXG4gICAgfVxyXG59XSk7XHJcblxuYW5ndWxhci5tb2R1bGUoJ3Jzc1JlYWRlcicpLmZhY3RvcnkoJ2Rhc2hib2FyZFNlcnZpY2UnLCBbJ2FkZEZlZWRTZXJ2aWNlJywgJyRmaWx0ZXInLCBmdW5jdGlvbihhZGRGZWVkU2VydmljZSwgJGZpbHRlcikge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGxpc3RGZWVkcyA9IGFkZEZlZWRTZXJ2aWNlLmdldFNhdmVkRmVlZHMoKTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDYXRlZ29yeVNpZGViYXIoKSB7XHJcbiAgICAgICAgdmFyIGxpc3RGZWVkU2lkZWJhciA9IFtdO1xyXG5cclxuICAgICAgICBpZiAobGlzdEZlZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsaXN0RmVlZHMuZm9yRWFjaChmdW5jdGlvbihlbGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgbGlzdEZlZWRTaWRlYmFyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBlbGVtLmZlZWRDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogaW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGVGZWVkczogW2VsZW0uZmVlZFRpdGxlXVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsaXN0RmVlZFNpZGViYXI7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEFydGljbGVzKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgdmFyIGFydGljbGVzO1xyXG5cclxuICAgICAgICBpZiAobGlzdEZlZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhcnRpY2xlcyA9IFtdO1xyXG4gICAgICAgICAgICBsaXN0RmVlZHMuZm9yRWFjaCggZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZWxlbS5mZWVkQXJ0aWNsZXMpO1xyXG4gICAgICAgICAgICAgICAgZWxlbS5mZWVkQXJ0aWNsZXMuZm9yRWFjaCggZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFydGljbGVzLnB1c2goZWxlbSlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFydGljbGVzO1xyXG4gICAgICAgIC8vIHJldHVybiBsaXN0RmVlZHMubGVuZ3RoID8gbGlzdEZlZWRzWzBdLmZlZWRBcnRpY2xlcyA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0QXJ0aWNsZXM6IGdldEFydGljbGVzLFxyXG4gICAgICAgIGdldENhdGVnb3J5U2lkZWJhcjogZ2V0Q2F0ZWdvcnlTaWRlYmFyXHJcbiAgICB9XHJcbn1dKTtcclxuIl0sImZpbGUiOiJhcHAubWluLmpzIn0=
